---
layout: default
title: ラボ 4 - 悪意あるパッケージの検知
---

# ラボ 4: 悪意あるパッケージの検知
この演習では、ソフトウェアサプライチェーン（SCS）の調査結果の内、いくつかの例とそれを修正する方法について説明します。

{: .important-title }
> 前提条件
>
> ここでは https://github.com/cxworkshops/totallysecureapp にある __totalsecureapp__ プロジェクトを使用します。まだ準備されていない場合は、[ラボ 1](../lab1_setup/) に定義されているようにプロジェクトをローカルパソコンに複製します。

{: .note }
この演習で悪意あるパッケージを確認している際には、プロジェクトコードを実行しません。システムに悪意あるパッケージが実行される危険性はありません。

## はじめに
良い開発者は効率的な開発者であり、効率的な開発者になる一部は、すべてのプロジェクトやソリューションの車輪を再発明するわけではありません。結果的に、私たちの多くが無料で利用できるオープンソースソフトウェアおよび/またはパッケージの利点を活用して、時間と労力を節約し、機能をより迅速に開発できます。これらのオープンソースソリューションは、多くの時間、労力、および面倒さを減らしますが、他の人のコードを私たちのプロジェクトにインポートすると、私たちがすべてのコードを直接開発すれば直面しなかった潜在的リスクと脆弱性にさらされます。

## SCS結果確認
SCS結果はCheckmarx SCAスキャンエンジンに含まれます。Checkmarx VS Codeプラグイン内の[ラボ 1](../lab1_setup/)の __プロジェクトとのリンク__ にて説明されているように、プロジェクト、ブランチ、スキャン結果への連携が正常であることを確認します。

### タイポスクワッティング(TypoSquatting)

1. VS Codeの左側のメニューからCheckmarxプラグインに移動し、メニューをsca> Malicious Package> HIGH resultsに展開します。


    ![SCA High Results](./assets/images/scs_high_results.png "SCA High Results")

2. Npm-momnet-2.29.1の結果を展開し、 __Cxa45b0853-bee2__ を選択します。悪意あるパッケージの説明と共に、一番右側に新しいウィンドウがどのように開くかを確認します。

    ![Cxa45b0853-bee2](./assets/images/Cxa45b0853-bee2.png "Cxa45b0853-bee2")

    {: .note }
    > これまでの共通の標準であるCVEの脆弱性とは異なり、悪意あるパッケージの標準化された汎用IDはありません。たとえば、同じイベントのIDは、製品ごとに以下のように異なります。:
    >
    > - cx-2021-b8833-be2146 (Checkmarx)
    > - SNYK-JS-RC-1911120 (Snyk)
    > - sonatype-2021-1696 (Sonatype)
    > - GHSA-g2q5-5433-rhrf (GitHub)

3. 悪意あるパッケージの説明によると、これは悪意あるパッケージであり、 __タイポスクワッティング(Typo Squatting)__ 攻撃を使用していることがわかります。パッケージ作成者は開発者が誤って"moment"を入力し、その悪意あるパッケージをインポートすることを望んでいます。この悪意あるパッケージには、内部HTML本体を削除してアプリケーションをクラッシュさせる悪意あるメソッドが含まれています。Vulnerable Package Pathsウィンドウにリンクされているpackage.jsonをクリックして、パッケージ名を __momnet__ から __moment__ に変更することで、この悪意あるパッケージを修正することができます。:


    ![momnet](./assets/images/momnet.png "momnet")

### リポジャッキング(RepoJacking)

1. Checkmarxプラグイン内のsca> Vulnerability> HIGHの結果の下で __Npm-ua-parser-js-0.7.29__ を展開し、 __Cxbd45c2b9-4622__ を選択します。

    ![ua-parser](./assets/images/ua-parser.png "ua-parser")

2. 悪意あるパッケージの説明を確認して、ua-parser-jsに3つのバージョンの悪意あるコードが配布されていることが確認できます。その3つのバージョン（0.7.29、0.8.0、および1.0.0）は、 __Repojacking__ とも呼ばれるアカウント乗っ取りの結果でした。修正アドバイスでバージョン0.7.30に変更して、悪意あるコードの影響がないバージョンにアップグレードできることを確認できます。

3. "Upgrade to Version"をクリックすると、Checkmarxプラグインは自動的にpackage.json内のパッケージバージョンを0.7.30に更新します。

    !["ua-parser-fix](./assets/images/ua-parser-fix.png "ua-parser-fix")


## メインポイント

- サプライチェーンセキュリティ（SCS）の結果は、Checkmarx SCAの結果に含まれています。
- CVEの脆弱性とは異なり、悪意あるパッケージには標準化された識別子はありません。
- サプライチェーン攻撃は驚くほど洗練されていませんが、簡単に統合できます。
- Checkmarx VS Codeプラグインは、特定のパッケージバージョンの自動修正を許可します。